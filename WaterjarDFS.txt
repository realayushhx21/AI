import java.util.*;

public class Main {

    static int A, B, T;
    static boolean[][] visited;

    static class State {
        int x, y;
        String action;

        State(int x, int y, String action) {
            this.x = x;
            this.y = y;
            this.action = action;
        }

        String key() {
            return x + "," + y;
        }
    }

    // Check gcd feasibility
    static int gcd(int a, int b) {
        while (b != 0) {
            int temp = a % b;
            a = b;
            b = temp;
        }
        return a;
    }

    // Generate next possible states
    static List<State> getNextStates(State s) {
        List<State> list = new ArrayList<>();

        list.add(new State(A, s.y, "Fill Jug A"));
        list.add(new State(s.x, B, "Fill Jug B"));

        list.add(new State(0, s.y, "Empty Jug A"));
        list.add(new State(s.x, 0, "Empty Jug B"));

        int transferAB = Math.min(s.x, B - s.y);
        list.add(new State(s.x - transferAB, s.y + transferAB, "Pour Jug A → Jug B"));

        int transferBA = Math.min(s.y, A - s.x);
        list.add(new State(s.x + transferBA, s.y - transferBA, "Pour Jug B → Jug A"));

        return list;
    }

    public static void main(String[] args) {

        Scanner sc = new Scanner(System.in);

        System.out.print("Enter capacity of Jug A: ");
        A = sc.nextInt();

        System.out.print("Enter capacity of Jug B: ");
        B = sc.nextInt();

        System.out.print("Enter target amount: ");
        T = sc.nextInt();

        // Feasibility check
        if (T > Math.max(A, B) || T % gcd(A, B) != 0) {
            System.out.println("No solution possible.");
            return;
        }

        visited = new boolean[A + 1][B + 1];

        Stack<State> stack = new Stack<>();
        List<State> solutionPath = new ArrayList<>();

        stack.push(new State(0, 0, "Start"));

        boolean solutionFound = false;

        while (!stack.isEmpty()) {

            State curr = stack.pop();

            if (visited[curr.x][curr.y])
                continue;

            visited[curr.x][curr.y] = true;
            solutionPath.add(curr);

            if (curr.x == T || curr.y == T) {
                solutionFound = true;
                break;
            }

            for (State next : getNextStates(curr)) {
                if (!visited[next.x][next.y]) {
                    stack.push(next);
                }
            }
        }

        if (!solutionFound) {
            System.out.println("No solution found.");
            return;
        }

        System.out.println("\nSolution found using DFS (Stack):");
        State last = solutionPath.get(solutionPath.size() - 1);

        for (State st : solutionPath) {
            System.out.println(st.action + " -> (" + st.x + ", " + st.y + ")");
        }

        System.out.println("\nTotal steps: " + (solutionPath.size() - 1));
        System.out.println("Final: (" + last.x + ", " + last.y + ") ✔");
        System.out.println("Target " + T + " liters achieved!");
    }
}
